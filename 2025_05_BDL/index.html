<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <meta name="author" content="Wassim Kabalan">
  <meta name="author" content="Alexandre Boucaud, François Lanusse">
  <title>JAXPM: A JAX-Based Framework for Scalable and Differentiable Particle Mesh Simulations</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-8b3c6da0781682310500f0ce9cbdf807.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="assets/titles/bayes_title_1.png" data-background-opacity="0.8" data-background-size="fill" class="center">
  <h1 class="title"><span style="color:#ffffff; font-size: largest;">JAXPM: A JAX-Based Framework for Scalable and Differentiable Particle Mesh Simulations</span></h1>
  <p class="author"><span style="color:#ffffff; font-size: larger;">Wassim Kabalan</span></p>
  <p class="author"><span style="color:#ffffff; font-size: Smaller;">Alexandre Boucaud, François Lanusse</span></p>
  <div style=""></div>
<div style="margin-top: 20px; text-align: center;align-items: bottom;">
  <div style="display: flex; justify-content: space-around; align-items: center; layout-valign=" middle"=""> <img src="assets/Logos/AstroDeep-2.png" style="width: 35%;"> <img src="assets/Logos/APC.png" style="width: 20%;"> <img src="assets/Logos/scipol.png" style="width: 35%;"> </div>
</div>

</section>
<section id="outline-for-this-presentation" class="slide level2">
<h2>Outline for This Presentation</h2>
<p><br> <br> <br></p>
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 22px; border-radius: 10px; border: 2px solid #3b0a68;">
<ul>
<li><span style="color:#1a237e; font-size: 26px;"><strong>Beyond Summary Statistics Inference in Cosmology</strong></span> <br> <br></li>
<li><span style="color:#1a237e; font-size: 26px;"><strong>Building N-body Simulators for Cosmological Inference</strong></span> <br> <br></li>
<li><span style="color:#1a237e; font-size: 26px;"><strong>Modeling Observables: Weak Lensing &amp; Lightcones</strong></span> <br> <br></li>
<li><span style="color:#1a237e; font-size: 26px;"><strong>Scaling Up: Distributed, Differentiable Simulations</strong></span></li>
</ul>
</div>
</div>
</section>
<section id="the-traditional-approach-to-cosmological-inference" class="slide level2" style="font-size: 22px;">
<h2>The Traditional Approach to Cosmological Inference</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><br></p>
<div class="r-stack">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/trad_cosmo.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><br> <br></p>
<ul>
<li><strong>cosmological parameters</strong> (Ω): matter density, dark energy, etc.</li>
<li>Predict observables: <strong>CMB, galaxies, lensing</strong></li>
<li>Extract <strong>summary statistics</strong>: <span class="math inline">\(P(k)\)</span>, <span class="math inline">\(C_\ell\)</span> , 2PCF</li>
<li>Compute <strong>likelihood</strong>: <span class="math inline">\(L(\Omega \vert data)\)</span></li>
<li>Estimate <span class="math inline">\(\hat{\Omega}\)</span> via <strong>maximization</strong> (<span class="math inline">\(\chi^2\)</span> fitting)</li>
</ul>
</div></div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p><strong>Summary Statistics Based Inference</strong></p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<ul>
<li>Traditional inference uses <strong>summary statistics</strong> to compress data.</li>
<li>Power spectrum fitting: <span class="math inline">\(P(k)\)</span>, <span class="math inline">\(C_\ell\)</span></li>
<li>It misses complex, non-linear structure in the data</li>
</ul>
</div>
</div>
</div>
<aside class="notes">
<p>“Most of modern cosmological inference pipelines rely on summary statistics — things like the power spectrum P(k)P(k) or angular power spectrum CℓCℓ​.”</p>
<p>“These work well under the assumption that most of the information is encoded in second-order statistics — basically, the correlations between pairs of points.”</p>
<p>“But this approach ignores all the higher-order structure — the full non-linear complexity that emerges in the formation of cosmic structure.”</p>
<p>Even higher-order statistics (like bispectrum or 3-point correlations) still reduce the data, and fail to capture the entire structure or allow for fully Bayesian inference over the field.</p>
<p>“And that’s the motivation for moving beyond summary statistics…”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-traditional-approach-to-cosmological-inference-1" class="slide level2" style="font-size: 22px;">
<h2>The Traditional Approach to Cosmological Inference</h2>
<p><br></p>
<div class="r-stack">
<div class="fragment fade-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/summ_stat.png" style="width:80.0%" data-text-align="right"></p>
<figcaption>Credit: Natalia Porqueres</figcaption>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/bad_posterior.png" style="width:50.0%"></p>
<figcaption><a href="https://arxiv.org/abs/2403.02314">Jeffrey et al.&nbsp;(2024)</a></figcaption>
</figure>
</div>
</div>
</div>
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 26px;">
<ul>
<li><strong>Summary statistics (e.g.&nbsp;P(k)) discard the non-Gaussian features.</strong></li>
<li><strong>Gradient-based curve fitting does not recover the true posterior shape.</strong></li>
</ul>
</div>
</div>
</section>
<section>
<section id="how-to-maximize-the-information-gain" class="title-slide slide level1 center">
<h1>How to maximize the information gain?</h1>

</section>
<section id="from-summary-statistics-to-likelihood-free-inference" class="slide level2" style="font-size: 19px;">
<h2>From Summary Statistics to Likelihood Free Inference</h2>
<p><br></p>
<div class="r-stack">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/likelihood_free_cosmo.svg" class="quarto-figure quarto-figure-center" style="width:60.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<h3 id="bayes-theorem">Bayes’ Theorem</h3>
<p><span class="math display">\[
p(\theta \mid x_0) \propto p(x_0 \mid \theta) \cdot p(\theta)
\]</span></p>
<ul>
<li><strong>Prior</strong>: Encodes our assumptions about parameters <span class="math inline">\(\theta\)</span></li>
<li><strong>Likelihood</strong>: How likely the data <span class="math inline">\(x_0\)</span> is given <span class="math inline">\(\theta\)</span></li>
<li><strong>Posterior</strong>: What we want to learn — how data updates our belief about <span class="math inline">\(\theta\)</span></li>
</ul>
</div>
<div class="fragment fade-in" data-fragment-index="2">
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 24px;">
<ul>
<li><strong>Simulators become the bridge between cosmological parameters and observables.</strong></li>
<li><strong>How to use simulators allow us to go beyond summary statistics?</strong></li>
</ul>
</div>
</div>
</div>
</section>
<section id="from-summary-statistics-to-likelihood-free-inference-1" class="slide level2" style="font-size: 19px;">
<h2>From Summary Statistics to Likelihood Free Inference</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:60%;">
<h4 id="implicit-inference"><strong>Implicit Inference</strong></h4>
<ul>
<li><p>Treats the simulator as a <strong>black box</strong> — we only require the ability to simulate <span class="math inline">\((\theta, x)\)</span> pairs.</p></li>
<li><p>No need for an explicit likelihood — instead, use <strong>simulation-based inference</strong> (SBI) techniques</p></li>
<li><p>Often relies on <strong>compression</strong> to summary statistics <span class="math inline">\(t = f_\phi(x)\)</span>, then approximates <span class="math inline">\(p(\theta \mid t)\)</span>.</p></li>
</ul>
<p><br></p>
<h4 id="explicit-inference"><strong>Explicit Inference</strong></h4>
<ul>
<li><p>Requires a <strong>differentiable forward model</strong> or simulator.</p></li>
<li><p>Treat the simulator as a probabilistic model and perform inference over the joint posterior <span class="math inline">\(p(x \mid \theta, z)\)</span></p></li>
<li><p>Computationally demanding — but provides <strong>exact control over the statistical model</strong>.</p></li>
</ul>
</div><div class="column" style="width:40%;">
<div class="r-stack">
<div class="fragment fade-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/likelihood_free_SBI.svg" style="width:80.0%"></p>
<figcaption>Implicit Inference</figcaption>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/likelihood_free_ffi.svg" style="width:90.0%"></p>
<figcaption>Explicit Inference</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="implicit-inference-1" class="slide level2" style="font-size: 20px;">
<h2>Implicit inference</h2>
<h4 id="simulation-based-inference-loop">Simulation-Based Inference Loop</h4>
<ul>
<li>Sample parameters <span class="math inline">\(\theta_i \sim p(\theta)\)</span></li>
<li>Run simulator <span class="math inline">\(x_i = p(x \vert \theta_i)\)</span></li>
<li>Compress observables <span class="math inline">\(t_i = f_\phi(x_i)\)</span></li>
<li>Train a <strong>density estimator</strong> <span class="math inline">\(\hat{p}_\Phi(\theta \mid f_\phi(x))\)</span></li>
</ul>
<div class="r-stack">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/illu_compressor.svg" class="quarto-figure quarto-figure-center" style="width:70.0%"></p>
</figure>
</div>
<div class="fragment fade-in-then-out" data-fragment-index="2">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/neural_comp.png" class="quarto-figure quarto-figure-center" style="width:40.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="3">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/normal_flows.png" class="quarto-figure quarto-figure-center" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 19px;">
<ul>
<li><strong>Neural Summarisation (Zeghal &amp; Lanzieri et al 2025).</strong></li>
<li><strong>Normalizing Flows (Zeghal et al.&nbsp;2022).</strong></li>
<li><strong>✅ Works with non-differentiable or stochastic simulators</strong></li>
<li><strong>❌ Requires an optimal compression function <span class="math inline">\(f_\phi\)</span></strong></li>
</ul>
</div>
</div>
</div>
</section>
<section id="explicit-inference-1" class="slide level2" style="font-size: 20px;">
<h2>Explicit inference</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p>The goal is to reconstruct the <strong>entire latent structure</strong> of the Universe — not just compress it into summary statistics. To do this, we jointly infer:</p>
<p><span class="math display">\[
p(\theta, z \mid x) \propto p(x \mid \theta, z) \, p(z \mid \theta) \, p(\theta)
\]</span></p>
<p><strong>Where:</strong></p>
<ul>
<li><p><span class="math inline">\(\theta\)</span>: cosmological parameters (e.g.&nbsp;matter density, dark energy, etc.)</p></li>
<li><p><span class="math inline">\(z\)</span>: latent fields (e.g.&nbsp;initial conditions of the density field)</p></li>
<li><p><span class="math inline">\(x\)</span>: observed data (e.g.&nbsp;convergence maps or galaxy fields)</p></li>
</ul>
<div class="fragment fade-in" data-fragment-index="1">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 19px;">
<p>The challenge of explicit inference</p>
</div>
<div class="solutionbox-body" style="font-size: 16px;">
<ul>
<li><p>The latent variables <span class="math inline">\(z\)</span> typically live in <strong>very high-dimensional spaces</strong> — with millions of degrees of freedom.</p></li>
<li><p>Sampling in this space is <strong>intractable using traditional inference techniques</strong>.</p></li>
</ul>
</div>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 16px;">
<ul>
<li>We need samplers that can scale efficiently to high-dimensional latent spaces and Exploit <strong>gradients</strong> from differentiable simulators</li>
<li>This makes <strong>differentiable simulators</strong> essential for modern cosmological inference.</li>
<li><strong>Particle Mesh (PM)</strong> simulations offer a scalable and differentiable solution.</li>
</ul>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="r-stack">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/likelihood_free_ffi.svg" style="width:90.0%"></p>
<figcaption>Explicit Inference</figcaption>
</figure>
</div>
</div>
</div></div>
</section>
<section id="particle-mesh-simulations" class="slide level2" style="font-size: 19px;">
<h2>Particle Mesh Simulations</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/PM_forces.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
<div class="fragment" data-fragment-index="1.fade-in">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/PM_interpolate.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div><div class="column" style="width:60%;">
<h3 id="compute-forces-via-pm-method">Compute Forces via PM method</h3>
<ul>
<li><strong>Start with particles</strong> <span class="math inline">\(\mathbf{x}_i, \mathbf{p}_i\)</span><br>
</li>
<li>Interpolate to mesh: <span class="math inline">\(\rho(\mathbf{x})\)</span><br>
</li>
<li>Solve Poisson’s Equation: <span class="math display">\[
\nabla^2 \phi = -4\pi G \rho
\]</span></li>
<li>In Fourier space: <span class="math display">\[
\mathbf{f}(\mathbf{k}) = i\mathbf{k}k^{-2}\rho(\mathbf{k})
\]</span></li>
</ul>
<div class="fragment fade-in" data-fragment-index="1">
<h3 id="time-evolution-via-ode">Time Evolution via ODE</h3>
<ul>
<li>PM uses <strong>Kick-Drift-Kick</strong> (symplectic) scheme:
<ul>
<li>Drift: <span class="math inline">\(\mathbf{x} \leftarrow \mathbf{x} + \Delta a \cdot \mathbf{v}\)</span></li>
<li>Kick: <span class="math inline">\(\mathbf{v} \leftarrow \mathbf{v} + \Delta a \cdot \nabla \phi\)</span></li>
</ul></li>
</ul>
</div>
</div></div>
<div class="fragment fade-in" data-fragment-index="2">
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 18px; border: 3px solid;">
<ul>
<li>Fast and scalable approximation to gravity.</li>
<li>A cycle of FFTs and interpolations.</li>
<li>Sacrifices small-scale accuracy for speed and differentiability.</li>
<li>Current implementations <strong>JAXPM v0.1</strong>, <strong>PMWD</strong> and <strong>BORG</strong>.</li>
</ul>
</div>
</div>
</div>
</section></section>
<section>
<section id="using-full-field-inference-with-weak-lensing" class="title-slide slide level1 center">
<h1>Using Full-Field Inference with Weak Lensing</h1>
<div class="r-stack">
<div class="fragment fade-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/bayes/FFI_full.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/FFI/FFI_wl_focus.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="from-3d-structure-to-lensing-observables" class="slide level2" data-visibility="uncounted" style="font-size: 19px;">
<h2>From 3D Structure to Lensing Observables</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="r-stack">
<div class="fragment fade-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/how_converge.svg" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in-then-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/lightcone_1.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in-then-out" data-fragment-index="2">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/lightcone_2.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in-then-out" data-fragment-index="3">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/lightcone_3.svg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="fragment fade-in" data-fragment-index="1">
<ul>
<li>Simulate structure formation over time, taking snapshots at key redshifts</li>
<li>Stitch these snapshots into a <strong>lightcone</strong>, mimicking the observer’s view of the universe</li>
<li>Combine contributions from all slabs to form convergence maps</li>
<li>Use the Born approximation to simplify the lensing calculation</li>
</ul>
</div>
<div class="fragment fade-in" data-fragment-index="3">
<div class="solutionbox">
<div class="solutionbox-header">
<p>Born Approximation for Convergence</p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<p><span class="math display">\[
\kappa(\boldsymbol{\theta}) = \int_0^{r_s} dr \, W(r, r_s) \, \delta(\boldsymbol{\theta}, r)
\]</span></p>
<p>Where the lensing weight is:</p>
<p><span class="math display">\[
W(r, r_s) = \frac{3}{2} \, \Omega_m \, \left( \frac{H_0}{c} \right)^2 \, \frac{r}{a(r)} \left(1 - \frac{r}{r_s} \right)
\]</span></p>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="can-we-start-doing-inference" class="title-slide slide level1 center">
<h1>Can we start doing inference?</h1>
<aside class="notes">
<p>“So we’ve built a forward model — from cosmology to lensing maps. Now comes the big question: can we start doing inference?” (click)</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h4 id="the-impact-of-resolution-on-simulation-accuracy">The impact of resolution on simulation accuracy</h4>
<div class="quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_512.png" style="width:75.0%"></p>
<figcaption><span class="math inline">\(512^3\)</span> Resolution mesh</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_256.png" style="width:75.0%"></p>
<figcaption><span class="math inline">\(256^3\)</span> Resolution mesh</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_64.png" style="width:75.0%"></p>
<figcaption><span class="math inline">\(64^3\)</span> Resolution mesh</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/power_spectrum_comparison.png" style="width:80.0%"></p>
<figcaption>-</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/biased_posterior_plot.png" style="width:50.0%"></p>
<figcaption>Biased Posterior</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
<aside class="notes">
<p>“Well… not yet. Not if we care about accuracy.” “Here’s what happens as we vary the resolution of the simulation mesh. Visually, the structure starts to break down. But more importantly, we lose power on small scales — and that directly biases the inferred cosmological parameters.” “So even if our inference machinery is technically running — the science is wrong.” “Low-resolution simulations introduce a significant systematic bias in the inferred parameters — even if the rest of the pipeline is perfect.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="when-the-simulator-fails-the-model-fails" class="slide level2">
<h2>When the Simulator Fails, the Model Fails</h2>
<h4 id="inference-is-only-as-good-as-the-simulator-it-depends-on.">Inference is only as good as the simulator it depends on.</h4>

<img data-src="assets/latest/illu_compressor.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:80.0%"><div class="solutionbox">
<div class="solutionbox-body" style="font-size: 18px; border: 3px solid;">
<ul>
<li>If we want to model complex phenomena like galaxy painting, baryonic feedback, or non-linear structure formation, our simulator must be not only fast, but also physically accurate.</li>
<li>A decent resolution for weak lensing requires about 1 grid cell per Mpc/h — both for angular resolution and structure fidelity.</li>
</ul>
</div>
</div>
</section>
<section id="scaling-up-the-simulation-volume-the-lsst-challenge" class="slide level2" style="font-size: 20px;">
<h2>Scaling Up the simulation volume: The LSST Challenge</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h4 id="lsst-scan-range">LSST Scan Range</h4>
<ul>
<li>Covers ~<strong>18,000 deg²</strong> (~44% of the sky)</li>
<li>Redshift reach: up to <strong>z ≈ 3</strong></li>
<li>Arcminute-scale resolution</li>
<li>Requires simulations spanning thousands of Mpc in depth and width</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/lsst_footprint.png" style="width:70.0%"></p>
<figcaption>LSST Survey Footprint</figcaption>
</figure>
</div>
</div></div>
<ul>
<li>Simulating even a <strong>(1 Gpc/h)³</strong> subvolume at <strong>1024³ mesh resolution</strong> requires:
<ul>
<li>~<strong>54 GB</strong> of memory for a simulation with a single snapshot</li>
<li>Gradient-based inference and multi-step evolution push that beyond <strong>100–200 GB</strong></li>
</ul></li>
</ul>
<div class="columns">
<div class="column" style="width:70%;">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 19px;">
<p><strong>Takeaway</strong></p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<ul>
<li>LSST-scale cosmological inference demands <strong>multiple (Gpc/h)³ simulations</strong> at high resolution.<br>
Modern high-end GPUs cap at <strong>~80 GB</strong>, so even a single box <strong>requires multi-GPU distributed simulation</strong> — both for memory and compute scalability.</li>
</ul>
</div>
</div>
</div><div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/HPC/jean_zay_photo.png" style="width:90.0%"></p>
<figcaption>Jean Zay HPC - IDRIS</figcaption>
</figure>
</div>
</div></div>
</section></section>
<section>
<section id="we-need-scalable-distributed-simulations" class="title-slide slide level1 center">
<h1>We Need Scalable Distributed Simulations</h1>

</section>
<section id="distributed-particle-mesh-simulation" class="slide level2" style="font-size: 20px;">
<h2>Distributed Particle Mesh Simulation</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="r-stack">
<div class="fragment fade-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/PM_pipeline.svg" style="width:100.0%"></p>
<figcaption>Particle Mesh Simulation</figcaption>
</figure>
</div>
</div>
<div class="fragment fade-in-then-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/pm_laplace_kernel.svg" style="width:100.0%"></p>
<figcaption>Particle Mesh Simulation</figcaption>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="2">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/pm_fft.svg" style="width:100.0%"></p>
<figcaption>Particle Mesh Simulation</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="1">
<h4 id="force-computation-is-easy-to-parallelize">Force Computation is Easy to Parallelize</h4>
<ul>
<li><p>Poisson’s equation in Fourier space:<br>
<span class="math display">\[
\nabla^2 \phi = -4\pi G \rho
\]</span></p></li>
<li><p>Gravitational force in Fourier space:<br>
<span class="math display">\[
\mathbf{f}(\mathbf{k}) = i\mathbf{k}k^{-2}\rho(\mathbf{k})
\]</span></p></li>
<li><p>Each Fourier mode <span class="math inline">\(\mathbf{k}\)</span> can be computed independently using JAX<br>
</p></li>
<li><p>Perfect for large-scale, parallel GPU execution</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Logos/JaxLogo.png" class="quarto-figure quarto-figure-center" style="width:20.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="3">
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 26px;">
<p><strong>Fourier Transform requires global communication</strong></p>
</div>
</div>
</div>
</div></div>
</section>
<section id="jaxdecomp-distributed-3d-fft-and-halo-exchange" class="slide level2" style="font-size: 20px;">
<h2>jaxDecomp: Distributed 3D FFT and Halo Exchange</h2>
<p><a href="https://github.com/DifferentiableUniverseInitiative/jaxDecomp"><img data-src="https://img.shields.io/badge/GitHub-jaxdecomp-blue?logo=github.png"></a></p>
<ul>
<li><strong>Distributed 3D FFT</strong> using <strong>domain decomposition</strong><br>
</li>
<li><strong>Fully differentiable</strong>, runs on <strong>multi-GPU and multi-node</strong> setups<br>
</li>
<li>Designed as a <strong>drop-in replacement</strong> for <code>jax.numpy.fft.fftn</code><br>
</li>
<li>Open source and available on <strong>PyPI</strong> <span class="math inline">\(\Rightarrow\)</span> <code>pip install jaxdecomp</code></li>
<li><strong>Halo exchange</strong> for mass conservation across subdomains</li>
</ul>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/jaxDecomp/fft.svg" style="width:90.0%"></p>
<figcaption>FFT</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/CIC/Halo_Exchange.svg" style="width:75.0%"></p>
<figcaption>Halo Exchange</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="distributed-particle-mesh-simulation-1" class="slide level2" style="font-size: 20px;">
<h2>Distributed Particle Mesh Simulation</h2>
<div class="r-stack">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/pm_cic.svg" style="width:60.0%"></p>
<figcaption>Particle Mesh Simulation</figcaption>
</figure>
</div>
</div>
</section>
<section id="cloud-in-cell-cic-interpolation" class="slide level2" style="font-size: 19px;">
<h2>Cloud In Cell (CIC) Interpolation</h2>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="r-stack quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="fragment fade-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/particles_animation.gif" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/particles_last_frame.png" class="quarto-figure quarto-figure-center" style="width:55.0%"></p>
</figure>
</div>
</div>
</div>
<div class="r-stack quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="fragment fade-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/field_animation.gif" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/field_last_frame.png" class="quarto-figure quarto-figure-center" style="width:55.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<h3 style="font-size: 19px;" id="mass-assignment-and-readout">Mass Assignment and Readout</h3>
<p>The Cloud-In-Cell (CIC) scheme spreads particle mass to nearby grid points using a linear kernel:</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><strong>Paint to Grid</strong> (mass deposition): <span class="math display">\[
g(\mathbf{j}) = \sum_i m_i \prod_{d=1}^{D} \left(1 - \left|p_i^d - j_d\right|\right)
\]</span></li>
</ul>
</div><div class="column" style="width:50%;">
<ul>
<li><strong>Read from Grid</strong> (force interpolation): <span class="math display">\[
v_i = \sum_{\mathbf{j}} g(\mathbf{j}) \prod_{d=1}^{D} \left(1 - \left|p_i^d - j_d\right|\right)
\]</span></li>
</ul>
</div></div>
</section>
<section id="distributed-cloud-in-cell-cic-interpolation" class="slide level2" style="font-size: 19px;">
<h2>Distributed Cloud In Cell (CIC) Interpolation</h2>
<ul>
<li><p>In distributed simulations, <strong>each subdomain handles a portion of the global domain</strong></p></li>
<li><p><strong>Boundary conditions</strong> are crucial to ensure physical continuity across subdomain edges</p></li>
<li><p><strong>CIC interpolation</strong> assigns and reads mass from nearby grid cells — potentially crossing subdomain boundaries</p></li>
<li><p>To avoid discontinuities or mass loss, we apply <strong>halo exchange</strong>:</p>
<ul>
<li>Subdomains <strong>share overlapping edge data</strong> with neighbors</li>
<li>Ensures <strong>correct mass assignment and gradient flow</strong> across boundaries</li>
</ul></li>
</ul>
<div class="r-stack">
<div class="fragment fade-in-then-out" data-fragment-index="1">
<h3 id="without-halo-exchange-not-distributed">Without Halo Exchange (Not Distributed)</h3>
<div class="quarto-layout-panel" data-align="center" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/D_CIC_Paint_0.svg" style="width:65.0%"></p>
<figcaption>Sub Domain 1 (Particles)</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/D_CIC_Paint_1.svg" style="width:65.0%"></p>
<figcaption>Sub Domain 1 (Grid)</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/D_CIC_Paint_2.svg" style="width:65.0%"></p>
<figcaption>Sub Domain 1 (Read out)</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="2">
<h3 id="with-halo-exchange-distributed">With Halo Exchange (Distributed)</h3>
<div class="quarto-layout-panel" data-align="center" data-layout-ncol="3">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/D_CIC_Paint_3.svg" style="width:65.0%"></p>
<figcaption>Sub Domain 1 &amp; Halo (Particles)</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/D_CIC_Paint_4.svg" style="width:65.0%"></p>
<figcaption>Sub Domain 1 &amp; Halo (Grid)</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/D_CIC_Paint_5.svg" style="width:65.0%"></p>
<figcaption>Sub Domain 2 &amp; Halo (Grid)</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="why-halo-exchange-matters-in-distributed-simulations" class="slide level2" style="font-size: 20px;">
<h2>Why Halo Exchange Matters in Distributed Simulations</h2>
<div class="fragment fade-in-then-out" data-fragment-index="1">
<p><img data-src="assets/HPC/depict_split.png" class="absolute" style="top: 30px; right: 20px; width: 20%; "></p>
</div>
<div class="fragment" data-fragment-index="2">
<p><img data-src="assets/HPC/depict_gathered.png" class="absolute" style="top: 30px; right: 20px; width: 20%; "></p>
</div>
<p>Without halo exchange, subdomain boundaries introduce visible artifacts in the final field.<br>
This breaks the smoothness of the result — <strong>even when each local computation is correct</strong>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="r-stack">
<div class="fragment fade-in-then-out" data-fragment-index="1">
<div class="quarto-layout-panel" data-layout="[[1] , [1] , [1] , [1]]" data-layout-align="center">
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_0_no_halo.png" class="nostretch" style="width:50.0%"></p>
<figcaption>First slice</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_1_no_halo.png" class="nostretch" style="width:50.0%"></p>
<figcaption>Second slice</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_2_no_halo.png" class="nostretch" style="width:50.0%"></p>
<figcaption>Third slice</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_3_no_halo.png" class="nostretch" style="width:50.0%"></p>
<figcaption>Fourth slice</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="2">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_1024_no_halo.png" class="nostretch" style="width:80.0%"></p>
<figcaption>No Halo Artifacts</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="r-stack">
<div class="fragment fade-in-then-out" data-fragment-index="2" style="visibility: hidden;">
<div class="quarto-layout-panel" data-layout="[[1] , [1] , [1] , [1]]" data-layout-align="center">
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_0_no_halo.png" class="nostretch" style="width:50.0%"></p>
<figcaption>First slice</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_1_no_halo.png" class="nostretch" style="width:50.0%"></p>
<figcaption>Second slice</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_2_no_halo.png" class="nostretch" style="width:50.0%"></p>
<figcaption>Third slice</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-center">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_3_no_halo.png" class="nostretch" style="width:50.0%"></p>
<figcaption>Fourth slice</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="3">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/Fields/LPT_density_field_z0_1024.png" class="nostretch" style="width:80.0%"></p>
<figcaption>With Halo no Artifacts</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="what-about-the-gradients" class="title-slide slide level1 center">
<h1>What About the Gradients?</h1>

</section>
<section id="backpropagating-through-ode-integration" class="slide level2" style="font-size: 20px;">
<h2>Backpropagating Through ODE Integration</h2>
<p><br> <br></p>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="why-gradients-are-costly">Why Gradients Are Costly</h3>
<p>To compute gradients through a simulation, we need to track:</p>
<ul>
<li>All intermediate positions: <span class="math inline">\(d_i\)</span></li>
<li>All velocities: <span class="math inline">\(v_i\)</span></li>
<li>And their tangent vectors for backpropagation</li>
</ul>
<p>Even though each update is simple, <strong>autodiff requires storing the full history</strong>.</p>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="2">
<h3 id="example-kick-drift-integration">Example: Kick-Drift Integration</h3>
<p>A typical update step looks like:</p>
<p><span class="math display">\[
\begin{aligned}
d_{i+1} &amp;= d_i + v_i \, \Delta t \\\\
v_{i+1} &amp;= v_i + F(d_{i+1}) \, \Delta t
\end{aligned}
\]</span></p>
<p>Over many steps, the memory demand scales <strong>linearly</strong> — which becomes a bottleneck for large simulations.</p>
</div>
</div></div>
<div class="fragment fade-in" data-fragment-index="3">
<div class="solutionbox">
<div class="solutionbox-header">
<p>Why This Is a Problem in Practice</p>
</div>
<div class="solutionbox-body">
<ul>
<li><p>Storing intermediate states for autodiff causes <strong>memory to scale linearly</strong> with the number of steps.</p></li>
<li><p>Example costs at full resolution:</p>
<ul>
<li><strong>(1 Gpc/h)³</strong>, 10 steps → ~<strong>500 GB</strong></li>
<li><strong>(2 Gpc/h)³</strong>, 10 steps → ~<strong>4.2 TB</strong></li>
</ul></li>
<li><p>This severely limits how many time steps or how large a volume we can afford — even with many GPUs.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="reverse-adjoint-gradient-propagation-without-trajectory-storage-preliminary" class="slide level2" style="font-size: 19px;">
<h2>Reverse Adjoint: Gradient Propagation Without Trajectory Storage (<strong>Preliminary</strong>)</h2>
<p><img data-src="assets/Logos/JaxLogo.png" class="absolute" style="top: 30px; right: 10px; width: 5%; "></p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Instead of storing the full trajectory…</p></li>
<li><p>We use the <strong>reverse adjoint method</strong>:</p>
<ul>
<li>Save only the <strong>final state</strong></li>
<li><strong>Re-integrate backward in time</strong> to compute gradients</li>
</ul></li>
</ul>
<div class="mathbox">
<p><strong>Forward Pass (Kick-Drift)</strong></p>
<p><span class="math display">\[
\begin{aligned}
d_{i+1} &amp;= d_i + v_i \, \Delta t \\
v_{i+1} &amp;= v_i + F(d_{i+1}) \, \Delta t
\end{aligned}
\]</span></p>
<p><strong>Reverse Pass (Adjoint Method)</strong></p>
<p><span class="math display">\[
\begin{aligned}
v_i &amp;= v_{i+1} - F(d_{i+1}) \, \Delta t \\
d_i &amp;= d_{i+1} - v_i \, \Delta t
\end{aligned}
\]</span></p>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/memory_vs_checkpoints.png" style="width:100.0%"></p>
<figcaption>Memory vs.&nbsp;Checkpoints</figcaption>
</figure>
</div>
<div class="caption" style="font-size: 14px; margin-top: 0.5rem;">
<ul>
<li><strong>Checkpointing</strong> saves intermediate simulation states periodically to reduce memory — but still grows with the number of steps.</li>
<li><strong>Reverse Adjoint</strong> recomputes on demand, keeping memory constant.</li>
</ul>
</div>
</div>
</div></div>
<div class="fragment fade-in" data-fragment-index="2">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 19px;">
<p>Reverse Adjoint Method</p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<ul>
<li><strong>Constant memory</strong> regardless of number of steps</li>
<li><strong>Requires a second simulation pass</strong> for gradient computation</li>
<li>In a 10-step 1024³ Lightcone simulation, reverse adjoint uses <strong>5× less memory</strong> than checkpointing (∼100 GB vs ∼500 GB)</li>
</ul>
</div>
</div>
</div>
</section></section>
<section>
<section id="putting-it-all-together" class="title-slide slide level1 center">
<h1>Putting It All Together</h1>

</section>
<section id="jaxpm-v0.1.5-differentiable-scalable-simulations" class="slide level2" data-background-image="assets/Fields/LPT_density_field_z0_2048.png" data-background-opacity="0.2" style="font-size: 20px;">
<h2><span style="color:black">JAXPM v0.1.5: Differentiable, Scalable Simulations </span></h2>
<p><a href="https://github.com/DifferentiableUniverseInitiative/JaxPM"><img data-src="https://img.shields.io/badge/GitHub-jaxpm-blue?logo=github.png"></a></p>
<p><br> <br> <br></p>
<div class="solutionbox">
<div class="solutionbox-header">
<p>What JAXPM v0.1.5 Supports</p>
</div>
<div class="solutionbox-body">
<ul>
<li><p><strong>Multi-GPU and Multi-Node</strong> simulation with distributed domain decomposition (Successfully ran 2048³ on 256 GPUs)</p></li>
<li><p><strong>End-to-end differentiability</strong>, including force computation and interpolation</p></li>
<li><p>Compatible with a custom JAX compatible Reverse <strong>Adjoint solver</strong> for memory-efficient gradients</p></li>
<li><p>Supports full <strong>PM Lightcone Weak Lensing</strong></p></li>
<li><p>Available on <strong>PyPI</strong>: <code>pip install jaxpm</code></p></li>
<li><p>Built on top of <code>jaxdecomp</code> for distributed 3D FFT</p></li>
</ul>
</div>
</div>
</section>
<section id="current-capabilities-road-ahead" class="slide level2" style="font-size: 20px;">
<h2>Current Capabilities &amp; Road Ahead</h2>
<div class="solutionbox">
<div class="solutionbox-header">
<p><strong>What We’ve Achieved So Far</strong></p>
</div>
<div class="solutionbox-body">
<ul>
<li><p>Built a <strong>scalable, differentiable</strong> N-body simulation pipeline (<strong>JAXPM</strong>)</p></li>
<li><p>Enables <strong>forward modeling and sampling</strong> in large cosmological volumes, paving the way toward full LSST-scale inference</p></li>
<li><p>Preliminary performance:</p>
<ul>
<li>~20 s per 512×512×1024 simulation on 64×A100 GPUs</li>
<li>&lt;1 TB memory for full 10-step lightcone</li>
<li>Stable gradients over 100-sample tests</li>
</ul></li>
</ul>
</div>
</div>
<p><br></p>
<div class="solutionbox">
<div class="solutionbox-header">
<p><strong>For discussion</strong></p>
</div>
<div class="solutionbox-body">
<ul>
<li><p><strong>Using Scattering Transform to compress the data with SBI</strong></p></li>
<li><p><strong>Using Excplicit Inference for CMB r estimation</strong></p></li>
</ul>
</div>
</div>
</section></section>
<section>
<section id="extra-slides" class="title-slide slide level1 center">
<h1>Extra slides</h1>

</section>
<section id="approximating-the-small-scales" class="slide level2" style="font-size: 19px;">
<h2>Approximating the Small Scales</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><br> <br></p>
<h4 id="dynamic-resultion-grid">Dynamic resultion grid</h4>
<ul>
<li> We can use a dynamic resolution that automatically refines the grid to match the density regaions blabla</li>
<li>  very difficult to differentialte and slow to compute</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/dynamic_grid.svg" style="width:50.0%"></p>
<figcaption>Dynamic Resolution Grid</figcaption>
</figure>
</div>
</div></div>
<div class="columns">
<div class="column" style="width:50%;">
<h4 id="multigrid-methods">Multigrid Methods</h4>
<ul>
<li> Multigrid solves the Poisson equation efficiently by combining coarse and fine grids</li>
<li> It’s still an approximation — it does <strong>not match the accuracy</strong> of solving on a uniformly fine grid</li>
<li> At high fidelity, fine-grid solvers outperform multigrid in recovering small-scale structure — critical for unbiased inference</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="r-stack">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/latest/multi_grid_1.svg" style="width:70.0%"></p>
<figcaption>Multigrid</figcaption>
</figure>
</div>
</div>
</div></div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Bayesian Deep Learning Workshop , 2025</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': true,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'slide',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/ASKabalan\.github\.io\/slides\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>