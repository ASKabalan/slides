<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <meta name="author" content="Wassim Kabalan">
  <meta name="dcterms.date" content="2025-10-01">
  <title>Generative AI with JAX</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-8ea94b9b6cc4f3079803cbb9af8917b8.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="assets/rubin.jpg" data-background-opacity="0.4" data-background-size="fill" class="center">
  <h1 class="title">Generative AI with JAX</h1>
  <p class="author">Wassim Kabalan</p>
  <p class="date">2025-10-01</p>
  <div style=""></div>
<div style="margin-top: 20px; text-align: center;align-items: bottom;">
  <div style="display: flex; justify-content: space-around; align-items: center; layout-valign=" middle"=""> <img src="assets/Logos/AstroDeep-2.png" style="width: 35%;"> <img src="assets/Logos/APC.png" style="width: 20%;"> <img src="assets/Logos/scipol.png" style="width: 35%;"> </div>
</div>

</section>
<section id="outline-for-this-presentation" class="slide level2">
<h2>Outline for This Presentation</h2>
<p><br> <br> <br></p>
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 22px;">
<ul>
<li><span style="color:#1a237e; font-size: 26px;"><strong>Introduction to Generative AI</strong></span> <br> <span style="color:#1a237e;">Understand the mathematical meaning of generating data</span> <br> <br></li>
<li><span style="color:#1a237e; font-size: 26px;"><strong>Deep dive into Generative Models</strong></span> <br> <span style="color:#1a237e;">Explore the different framework and state of the art ways of generative AI</span> <br> <br></li>
<li><span style="color:#1a237e; font-size: 26px;"><strong>JAX eco system</strong></span> <br> <span style="color:#1a237e;">Learn core JAX transforms (jit, vmap, grad) and Flax tooling</span> <br> <br></li>
<li><span style="color:#1a237e; font-size: 26px;"><strong>Hands on tutorial</strong></span> <br> <br> <span style="color:#1a237e;">Explore how generative AI can be used for cosmological inference</span></li>
</ul>
</div>
</div>
<aside class="notes">
<p>This workshop covers three main sections: first, we’ll explore different generative AI models and their mathematical properties. Then we’ll introduce JAX and its ecosystem for high-performance computing. Finally, we’ll apply these techniques to real cosmology problems with hands-on notebooks.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section>
<section id="what-is-generative-ai" class="title-slide slide level1 center">
<h1>What is Generative AI?</h1>

</section>
<section id="what-does-generate-mean" class="slide level2">
<h2>What does “generate” mean?</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/generated_faces.jpg" style="width:90.0%"></p>
<figcaption>Generated faces example</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="r-stack">
<div class="fragment fade-in-then-out" data-fragment-index="2">
<p><img data-src="assets/generated/discrete_select.png" style="width:100.0%"></p>
</div>
<div class="fragment fade-in" data-fragment-index="3">
<p><img data-src="assets/generated/continuos_generate.png" style="width:100.0%"></p>
</div>
</div>
</div></div>
<div class="solutionbox fragment fade-in" data-fragment-index="4">
<div class="solutionbox-header" style="font-size: 20px;">
<p>Key Idea: Generative AI</p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<ul>
<li>Generative AI is about learning the underlying distribution <span class="math inline">\(p(\text{data})\)</span> and sampling from it to generate images.</li>
<li>The output of a generative model is a new data point.</li>
<li><span style="color:#1a237e;"><strong>Generative</strong></span> is intrinsically related to <span style="color:#1a237e;"><strong>probability distributions</strong></span>.</li>
</ul>
</div>
</div>
<aside class="notes">
<p>Generative AI is about learning probability distributions over data. Unlike discrete lookup tables, generative models learn continuous distributions and can sample entirely new data points. The key is modeling <span class="math inline">\(p(\text{data})\)</span> accurately enough to generate realistic samples.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="generative-models" class="title-slide slide level1 center">
<h1>Generative Models</h1>

</section>
<section id="generative-adversarial-networks-gans" class="slide level2">
<h2>Generative Adversarial Networks (GANs)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="1">
<p><br> <br></p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/gan_diagram.png" class="img-border-2"></p>
<figcaption>GAN Architecture</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="2">
<p><img data-src="assets/gan_title.png" style="width:95.0%"></p>
<div class="solutionbox">
<div class="solutionbox-body" style="font-size: 18px;">
<p><span class="math display">\[\min_G \max_D \mathbb{E}_{x\sim p_\text{data}}[\log D(x)] + \mathbb{E}_{z\sim p(z)}[\log(1 - D(G(z)))]\]</span></p>
<ul>
<li>Loss function
<ul>
<li>Generator: produces samples G(z) to fool D</li>
<li>Discriminator: estimates real vs fake probability D(·)</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div><div class="fragment fade-in" data-fragment-index="3">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>Advantages and Limitations</p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<ul>
<li>Advantages: sharp samples; flexible implicit modeling; no explicit likelihood.</li>
<li>Limitations: unstable training; mode collapse; sensitive to architecture and tricks.</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="limitations-with-gans" class="slide level2">
<h2>Limitations with GANs</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="1">
<h3 id="unstable-learning">Unstable learning</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/gan/nash_equilibrium.png" style="width:100.0%"></p>
<figcaption>Nash equilibrium illustration</figcaption>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="2">
<h3 id="mode-collapse">Mode collapse</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/gan/mode_collapse.png" style="width:100.0%"></p>
<figcaption>Mode collapse</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="3">
<h3 id="vanishing-gradients">Vanishing gradients</h3>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/gan/GAN_vanishing_gradient.png" class="img-border-2" style="width:65.0%"></p>
<figcaption>Vanishing gradients</figcaption>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="4">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>Some possible solutions</p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<ul>
<li>Use WGAN for more stable training and stronger gradients.</li>
<li>Add gradient penalty (WGAN-GP) to keep the critic smooth.</li>
</ul>
</div>
</div>
</div>
</div></div>
</section>
<section id="variational-autoencoders-vaes" class="slide level2">
<h2>Variational Autoencoders (VAEs)</h2>
<div class="columns">
<div class="column" style="width:55%;">
<div class="r-stack">
<div class="fragment fade-in-then-out" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/vae/autoencoder-schema.png" class="img-border-2" style="width:65.0%"></p>
<figcaption>Autoencoder architecture</figcaption>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="2">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/vae_arch.png" class="img-border-2" style="width:95.0%"></p>
<figcaption>VAE architecture</figcaption>
</figure>
</div>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="5">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>VAE takeaways</p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<ul>
<li>VAE learn optimal compression into the latent space</li>
<li>Represents a dataset by an easy to sample gaussian distribution</li>
<li>Compared to GAN gives a better access to probability distribution</li>
<li>Produces blurrier images than GANs</li>
</ul>
</div>
</div>
</div>
</div><div class="column" style="width:45%;">
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/vae_title.png" style="width:100.0%"></p>
<figcaption>VAE paper title</figcaption>
</figure>
</div>
</div>
<div class="fragment fade-in" data-fragment-index="2">
<p>Evidence Lower Bound (ELBO):</p>
<p><span class="math display">\[\mathcal{L} = \mathbb{E}_{q_\phi(z|x)}[\log p_\theta(x|z)] - \text{KL}(q_\phi(z|x)\|p(z))\]</span></p>
<ul>
<li><strong>Reconstruction</strong>: decoder quality</li>
<li><strong>KL Divergence</strong>: latent regularization</li>
</ul>
<p>Reparameterization trick: <span class="math display">\[z = \mu + \sigma \odot \epsilon, \quad \epsilon \sim \mathcal{N}(0,I)\]</span></p>
</div>
</div></div>
<aside class="notes">
<p>VAEs use an encoder-decoder architecture with a probabilistic latent space. The encoder outputs mean and log-variance for a Gaussian posterior. The reparameterization trick allows backpropagation through the stochastic sampling. The ELBO balances reconstruction quality against matching a prior distribution, typically standard normal.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="vae-why-kl-matters-β-vae" class="slide level2 smaller">
<h2>VAE — Why KL matters (β-VAE)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="1">
<p><strong>Without KL regularization</strong>:</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/vae_no_kl.png" class="img-border-2" style="width:60.0%"></p>
<figcaption>Unregularized</figcaption>
</figure>
</div>
<p>Latent space is unstructured</p>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="2">
<p><strong>With KL regularization</strong>:</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/vae_with_kl.png" class="img-border-2" style="width:60.0%"></p>
<figcaption>Regularized</figcaption>
</figure>
</div>
<p>Organized, continuous latent space</p>
</div>
</div></div>
<div class="fragment fade-in" data-fragment-index="3">
<p><strong>β-VAE objective</strong>:</p>
<p><span class="math display">\[\mathcal{L}_\beta = \mathbb{E}[\log p_\theta(x|z)] - \beta \cdot \text{KL}(q_\phi(z|x)\|p(z))\]</span></p>
<ul>
<li><span class="math inline">\(\beta &gt; 1\)</span>: More disentanglement, less reconstruction</li>
<li><span class="math inline">\(\beta &lt; 1\)</span>: Better reconstruction, less structure</li>
<li><strong>Limitation</strong>: Gaussian prior can bias toward simpler shapes</li>
</ul>
</div>
<aside class="notes">
<p>The KL term is crucial for organizing the latent space. Without it, the encoder can map inputs to arbitrary regions making interpolation meaningless. Beta-VAE introduces a hyperparameter β to control the tradeoff between reconstruction quality and latent space disentanglement. Higher β encourages more interpretable latent dimensions but may reduce reconstruction fidelity.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="vae-in-cosmology-deblending" class="slide level2 smaller">
<h2>VAE in Cosmology (Deblending)</h2>
<div class="absolute" style="bottom: 20px; right: 20px; width: 12%; ">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="https://avatars.githubusercontent.com/u/93823951?v=4.png" class="img-border-2" style="width:100.0%"></p>
<figcaption>Binh Nguyen</figcaption>
</figure>
</div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/ai/deblender_diagram.png" class="img-border-2" style="width:85.0%"></p>
<figcaption>Deblender architecture</figcaption>
</figure>
</div>
<div class="fragment fade-in" data-fragment-index="2">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/ai/distribution_e1_e2_recon_pred_no_filtered.png" class="img-border-2" style="width:95.0%"></p>
<figcaption>Distribution e1/e2</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/ai/recons_t2.png" class="img-border-2" style="width:95.0%"></p>
<figcaption>Reconstructions</figcaption>
</figure>
</div>
</div>
</div></div>
<aside class="notes">
<p>In cosmology, VAEs are used for galaxy deblending and morphology analysis. The latent representation can compress galaxy images efficiently. However, the Gaussian prior assumption can bias reconstructions toward rounder shapes, which is problematic for weak lensing studies that need accurate ellipticity measurements. This motivates using more flexible priors like normalizing flows.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="normalizing-flows-flow-based-generative-models" class="slide level2">
<h2>Normalizing Flows (Flow-based Generative Models)</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/flow_diagram.png" class="img-border-2" style="width:60.0%"></p>
<figcaption>Flow intuition (© Lilian Weng, Lil’Log)</figcaption>
</figure>
</div>
<div class="columns">
<div class="column" style="width:60%;">
<div class="fragment fade-in" data-fragment-index="1">
<p>Mappings: <span class="math inline">\(f(x) \to y\)</span>, <span class="math inline">\(g(y) = z\)</span>; <span class="math inline">\(z = g_{\theta}(x) = g_K \circ \cdots \circ g_1(x)\)</span></p>
<p><strong>Log-likelihood</strong></p>
<p><span class="math display">\[\log p_{\theta}(x) = \log p_Z\big(g_{\theta}(x)\big)
  + \sum_{k=1}^{K} \log \left|\det J_{g_k}\right|\]</span></p>
</div>
</div><div class="column" style="width:40%;">
<div class="fragment fade-in" data-fragment-index="1">
<img data-src="assets/rezende_title.png" class="img-border-2" style="width:100.0%">
<p style="text-align:center; font-size: 12px; margin-top: 2px;">
Rezende &amp; Mohamed (2015)
</p>
</div>
</div></div>
<div class="fragment fade-in" data-fragment-index="2">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>In short</p>
</div>
<div class="solutionbox-body" style="font-size: 16px;">
<ul>
<li>Gaussianize data: <span class="math inline">\(z = g_{\theta}(x) \approx \mathcal{N}(0, I)\)</span>.</li>
<li>Exact likelihood: <span class="math inline">\(\log p_{\theta}(x) = \log p_Z(z) + \sum_k \log|\det J_{g_k}|\)</span>.</li>
<li>Generate via inverse: <span class="math inline">\(x = f_{\theta}(z)\)</span>, <span class="math inline">\(z \sim p_Z\)</span>.</li>
</ul>
</div>
</div>
</div>
<aside class="notes">
<p>Flows learn an invertible transform mapping a simple base <span class="math inline">\(p_Z\)</span> (e.g., <span class="math inline">\(\mathcal{N}(0,I)\)</span>) to the data distribution. Training maximizes the exact likelihood via the change-of-variables formula with tractable log-determinants.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="coupling-layers-forward-vs-inverse" class="slide level2">
<h2>Coupling Layers : Forward vs Inverse</h2>

<img data-src="assets/coupling_flow.svg" class="img-border-2 r-stretch quarto-figure-center" style="width:60.0%"><p class="caption">Coupling layer computation graph</p><div class="columns">
<div class="column" style="width:55%;">
<p><strong>Forward (x → y)</strong></p>
<ol type="1">
<li>Split <span class="math inline">\(x=(x_a, x_b)\)</span> by mask.</li>
<li>Conditioning network on kept half: <span class="math inline">\((s, t) = \text{NN}(x_a)\)</span>.</li>
<li>Affine update (element-wise):</li>
</ol>
<p><span class="math display">\[
y_a = x_a, \qquad
y_b = x_b \odot e^{s(x_a)} + t(x_a).
\]</span></p>
</div><div class="column" style="width:45%;">
<p><strong>Inverse (y → x)</strong></p>
<p>Given <span class="math inline">\((y_a, y_b)\)</span>:</p>
<ol type="1">
<li>Recompute <span class="math inline">\((s, t) = \text{NN}(y_a)\)</span>.</li>
<li>Invert the affine on the transformed half:</li>
</ol>
<p><span class="math display">\[
x_a = y_a, \qquad
x_b = \big(y_b - t(y_a)\big) \odot e^{-s(y_a)}.
\]</span></p>
</div></div>
</section>
<section id="masked-autoregressive-flow-maf-vs-inverse-autoregressive-flow-iaf" class="slide level2">
<h2>Masked Autoregressive Flow (MAF) vs Inverse Autoregressive Flow (IAF)</h2>

<img data-src="assets/MAF-vs-IAF.png" class="img-border-2 r-stretch quarto-figure-center" style="width:100.0%"><p class="caption">MAF vs IAF comparison</p><div class="columns">
<div class="column" style="width:40%;">
<p><strong>MAF (Masked Autoregressive Flow)</strong></p>
<p>Autoregressive flow where density evaluation is <strong>parallel</strong> sampling is <strong>sequential</strong>.</p>
<p><span class="math display">\[
z_i=\frac{x_i-\mu_i(x_{&lt;i})}{\sigma_i(x_{&lt;i})}
\]</span></p>
</div><div class="column" style="width:20%;">

</div><div class="column" style="width:40%;">
<p><strong>IAF (Inverse Autoregressive Flow) — fast sampling</strong></p>
<p>Same masked structure but reversed so sampling is <strong>parallel</strong> (given <span class="math inline">\(z\)</span>), density is <strong>sequential</strong>.</p>
<p><span class="math display">\[
x_i=\mu_i(z_{&lt;i})+\sigma_i(z_{&lt;i})\cdot z_i    
\]</span></p>
</div></div>
</section>
<section id="diffusion-models" class="slide level2">
<h2>Diffusion Models</h2>
<div class="columns">
<div class="column" style="width:55%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/ddpm_box.png" class="img-border-2" style="width:100.0%"></p>
<figcaption>DDPM process</figcaption>
</figure>
</div>
<div class="fragment fade-in" data-fragment-index="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="assets/diffusion_spiral.png" class="img-border-2" style="width:80.0%"></p>
<figcaption>Diffusion visualization</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:45%;">
<p><img data-src="assets/ddpm_title.png" class="img-border-2" style="width:95.0%"></p>
<div class="fragment fade-in" data-fragment-index="2">
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>Characteristics of Diffusion Models</p>
</div>
<div class="solutionbox-body" style="font-size: 18px;">
<p>Pros:</p>
<ul>
<li><strong>Best quality &amp; coverage:</strong> diffusion / flow-matching models for images; rapidly improving for video.</li>
</ul>
<p>Cons:</p>
<ul>
<li>High computational cost for training and sampling.</li>
</ul>
</div>
</div>
</div>
</div></div>
<aside class="notes">
<p>Ultra-compact variant (if space is tight): Diffusion/flow-matching (DiT/RFT) lead in quality; video catching up. Cost = sampling, eased by consistency + distillation.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="generative-models-overview" class="slide level2">
<h2>Generative models overview</h2>

<img data-src="assets/generative-overview.png" class="img-border-2 quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="generative-models-overview-1" class="slide level2">
<h2>Generative models overview</h2>
<table class="caption-top" style="width:100%;">
<colgroup>
<col style="width: 36%">
<col style="width: 31%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>VAE</strong></td>
<td>- Explicit likelihood<br>- Fast sampling<br>- Good global structure</td>
<td>- Blurry outputs<br>- Prior bias (Gaussian)<br>- Limited expressiveness</td>
</tr>
<tr class="even">
<td><strong>GAN</strong></td>
<td>- Sharp, high-quality images<br>- Fast sampling</td>
<td>- Training instability<br>- Mode collapse<br>- No likelihood</td>
</tr>
<tr class="odd">
<td><strong>Flow</strong></td>
<td>- Exact likelihood<br>- Invertible<br>- Flexible distributions</td>
<td>- Computationally expensive<br>- Architecture constraints<br>- Difficult to scale</td>
</tr>
<tr class="even">
<td><strong>Diffusion</strong></td>
<td>- SOTA quality<br>- Excellent mode coverage<br>- Stable training</td>
<td>- Slow sampling (many steps)<br>- Computationally intensive<br>- Careful tuning required</td>
</tr>
</tbody>
</table>
<aside class="notes">
<p>Each generative model family has distinct tradeoffs. VAEs offer fast training and sampling but produce blurry outputs. GANs generate sharp images but are unstable to train. Flows provide exact likelihoods but are computationally expensive. Diffusion models achieve the best quality but require many sampling steps. Choose based on your application requirements.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="jax-ecosystem" class="title-slide slide level1 center">
<h1>JAX Ecosystem</h1>

</section>
<section id="what-is-jax" class="slide level2 smaller">
<h2>What is JAX?</h2>

<img data-src="assets/jax_openxla.png" class="img-border-2 r-stretch" style="width:100.0%"><div style="display:flex;justify-content:center;align-items:center;height:100%;">
<pre><code>&lt;h2 style="margin:0;"&gt;JAX and OpenXLA&lt;/h2&gt;</code></pre>
</div>
<aside class="notes">
<p>JAX provides a NumPy-compatible API with powerful function transformations. grad computes derivatives, jit compiles to optimized XLA code, vmap vectorizes operations, and pmap parallelizes across devices. JAX enforces functional programming: functions must be pure without side effects. Randomness is explicit via PRNG key splitting. The same code runs efficiently on CPU, GPU, or TPU through XLA compilation.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="jax-transforms" class="slide level2">
<h2>JAX transforms</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="jit-just-in-time-compilation">JIT (Just in time compilation)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="im">import</span> jax</span>
<span id="cb2-2"><a></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb2-3"><a></a></span>
<span id="cb2-4"><a></a><span class="at">@jax.jit</span></span>
<span id="cb2-5"><a></a><span class="kw">def</span> f(x): </span>
<span id="cb2-6"><a></a>    <span class="cf">return</span> jnp.sin(x<span class="op">**</span><span class="dv">2</span>) <span class="op">+</span> jnp.cos(x)</span>
<span id="cb2-7"><a></a></span>
<span id="cb2-8"><a></a><span class="co"># compiled once, runs fast</span></span>
<span id="cb2-9"><a></a>y <span class="op">=</span> f(jnp.linspace(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">1_000</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="1">
<h3 id="auto-vectorization-vmap">Auto-vectorization (vmap)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a><span class="im">import</span> jax</span>
<span id="cb3-2"><a></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb3-3"><a></a></span>
<span id="cb3-4"><a></a><span class="kw">def</span> score(x, w): </span>
<span id="cb3-5"><a></a>    <span class="cf">return</span> x <span class="op">@</span> w        <span class="co"># single example</span></span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a>batched_score <span class="op">=</span> jax.vmap(score, in_axes<span class="op">=</span>(<span class="dv">0</span>, <span class="va">None</span>))</span>
<span id="cb3-8"><a></a>y <span class="op">=</span> batched_score(X_batch, w)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
<p><br> <br></p>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="grad-automatic-differentiation">grad (automatic differentiation)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="im">import</span> jax</span>
<span id="cb4-2"><a></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb4-3"><a></a></span>
<span id="cb4-4"><a></a><span class="kw">def</span> loss(w, x, y):</span>
<span id="cb4-5"><a></a>     <span class="cf">return</span> ((x <span class="op">@</span> w <span class="op">-</span> y)<span class="op">**</span><span class="dv">2</span>).mean()</span>
<span id="cb4-6"><a></a></span>
<span id="cb4-7"><a></a><span class="co"># grad w.r.t. first arg</span></span>
<span id="cb4-8"><a></a>dl_dw <span class="op">=</span> jax.grad(loss)(w, x, y)</span>
<span id="cb4-9"><a></a><span class="co"># 2nd derivative</span></span>
<span id="cb4-10"><a></a>dl_dl_dw <span class="op">=</span> jax.grad(jax.grad(loss))(w, x, y)</span>
<span id="cb4-11"><a></a><span class="co"># Hessian matrix</span></span>
<span id="cb4-12"><a></a>hessian_dw <span class="op">=</span> jax.hessian(loss)(w, x, y)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column" style="width:50%;">
<div class="fragment fade-in" data-fragment-index="2">
<h3 id="multi-device-parallelism-shard_map">Multi-device parallelism (shard_map)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a></a><span class="im">import</span> jax</span>
<span id="cb5-3"><a></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb5-4"><a></a></span>
<span id="cb5-5"><a></a>mesh <span class="op">=</span> jax.sharding.Mesh(np.array(jax.devices()), (<span class="st">'data'</span>,))</span>
<span id="cb5-6"><a></a></span>
<span id="cb5-7"><a></a><span class="kw">def</span> double(x):</span>
<span id="cb5-8"><a></a>     <span class="cf">return</span> x <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb5-9"><a></a>     </span>
<span id="cb5-10"><a></a>double_sharded <span class="op">=</span> jax.shard_map(double, mesh<span class="op">=</span>mesh,</span>
<span id="cb5-11"><a></a>        in_specs<span class="op">=</span>jax.sharding.PartitionSpec(<span class="st">'data'</span>, <span class="va">None</span>),</span>
<span id="cb5-12"><a></a>        out_specs<span class="op">=</span>jax.sharding.PartitionSpec(<span class="st">'data'</span>, <span class="va">None</span>))</span>
<span id="cb5-13"><a></a></span>
<span id="cb5-14"><a></a><span class="co"># shard over axis 0</span></span>
<span id="cb5-15"><a></a>x <span class="op">=</span> jnp.arange(<span class="dv">8</span>).reshape(<span class="bu">len</span>(jax.devices()), <span class="op">-</span><span class="dv">1</span>) </span>
<span id="cb5-16"><a></a>y <span class="op">=</span> double_sharded(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section>
<section id="tiny-gradient-demo" class="slide level2">
<h2>tiny gradient demo</h2>
<p><br> <br></p>
<h3 id="computing-gradients-with-pytorch">Computing gradients with PyTorch</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="im">import</span> torch</span>
<span id="cb6-2"><a></a>x <span class="op">=</span> torch.randn(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb6-3"><a></a>w <span class="op">=</span> torch.randn(<span class="dv">5</span>, <span class="dv">3</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-4"><a></a></span>
<span id="cb6-5"><a></a>y <span class="op">=</span> x <span class="op">@</span> w</span>
<span id="cb6-6"><a></a>loss <span class="op">=</span> y.<span class="bu">sum</span>()</span>
<span id="cb6-7"><a></a>loss.backward()</span>
<span id="cb6-8"><a></a><span class="bu">print</span>(w.grad)              <span class="co"># gradient lives on tensor state</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><br> <br></p>
<h3 id="computing-gradients-with-jax">Computing gradients with JAX</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a><span class="im">import</span> jax, jax.numpy <span class="im">as</span> jnp</span>
<span id="cb7-2"><a></a></span>
<span id="cb7-3"><a></a><span class="kw">def</span> loss(w, x):</span>
<span id="cb7-4"><a></a>    <span class="cf">return</span> (x <span class="op">@</span> w).<span class="bu">sum</span>()</span>
<span id="cb7-5"><a></a></span>
<span id="cb7-6"><a></a>x <span class="op">=</span> jnp.ones((<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb7-7"><a></a>w <span class="op">=</span> jnp.ones((<span class="dv">5</span>, <span class="dv">3</span>))</span>
<span id="cb7-8"><a></a>grad_w <span class="op">=</span> jax.grad(loss)(w, x)</span>
<span id="cb7-9"><a></a><span class="bu">print</span>(grad_w)              <span class="co"># returns new array; no hidden state</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="implications-of-functional-programming" class="slide level2">
<h2>Implications of functional programming</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="no-impure-functions">No impure functions</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a><span class="im">import</span> jax, jax.numpy <span class="im">as</span> jnp</span>
<span id="cb8-2"><a></a>state <span class="op">=</span> {<span class="st">"counter"</span>: <span class="dv">0</span>}</span>
<span id="cb8-3"><a></a></span>
<span id="cb8-4"><a></a><span class="at">@jax.jit</span></span>
<span id="cb8-5"><a></a><span class="kw">def</span> bad(x):</span>
<span id="cb8-6"><a></a>    <span class="co"># ❌ side-effect breaks JIT/purity</span></span>
<span id="cb8-7"><a></a>    state[<span class="st">"counter"</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-8"><a></a>    <span class="cf">return</span> x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-9"><a></a></span>
<span id="cb8-10"><a></a><span class="at">@jax.jit</span></span>
<span id="cb8-11"><a></a><span class="kw">def</span> good(x, state):</span>
<span id="cb8-12"><a></a>    <span class="co"># ✅ pure function</span></span>
<span id="cb8-13"><a></a>    state <span class="op">=</span> {<span class="st">"counter"</span>: state[<span class="st">"counter"</span>] <span class="op">+</span> <span class="dv">1</span>}  </span>
<span id="cb8-14"><a></a>    <span class="cf">return</span> x <span class="op">+</span> <span class="dv">1</span>, state</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<h3 id="explicit-prng-keys">Explicit PRNG keys</h3>
<h4 id="numpy-rng">Numpy RNG</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb9-3"><a></a>x <span class="op">=</span> np.random.normal(size<span class="op">=</span>(<span class="dv">100</span>,))</span>
<span id="cb9-4"><a></a>y <span class="op">=</span> np.random.uniform(size<span class="op">=</span>(<span class="dv">100</span>,))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column" style="width:50%;">
<h4 id="no-inplace-mutations">No inplace mutations</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb10-2"><a></a>x <span class="op">=</span> jnp.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb10-3"><a></a></span>
<span id="cb10-4"><a></a><span class="at">@jax.jit</span></span>
<span id="cb10-5"><a></a><span class="kw">def</span> bad(x):</span>
<span id="cb10-6"><a></a>    x[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">10</span>               <span class="co"># ❌ JAX arrays are immutable</span></span>
<span id="cb10-7"><a></a>    <span class="cf">return</span> x</span>
<span id="cb10-8"><a></a></span>
<span id="cb10-9"><a></a><span class="at">@jax.jit</span></span>
<span id="cb10-10"><a></a><span class="kw">def</span> good(x):</span>
<span id="cb10-11"><a></a>    x <span class="op">=</span> x.at[<span class="dv">0</span>].<span class="bu">set</span>(<span class="dv">10</span>)     <span class="co"># ✅ returns new array</span></span>
<span id="cb10-12"><a></a>    <span class="cf">return</span> x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><br> <br></p>
<h4 id="jax-rng">JAX RNG</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a><span class="im">import</span> jax.random <span class="im">as</span> jr</span>
<span id="cb11-2"><a></a>key <span class="op">=</span> jr.PRNGKey(<span class="dv">0</span>)</span>
<span id="cb11-3"><a></a>k1 , k2 <span class="op">=</span> jr.split(key)</span>
<span id="cb11-4"><a></a>x <span class="op">=</span> jr.normal(k1, shape<span class="op">=</span>(<span class="dv">100</span>,))</span>
<span id="cb11-5"><a></a>y <span class="op">=</span> jr.uniform(k2, shape<span class="op">=</span>(<span class="dv">100</span>,))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>In general</p>
</div>
<div class="solutionbox-body" style="font-size: 16px;">
<ul>
<li>All modified variables must be passed explicitly as function arguments and return values.</li>
<li>All arrays are immutable; use <code>.at[].set()</code> or similar to create modified copies.</li>
</ul>
</div>
</div>
</section>
<section id="neural-nets-in-jax-flax" class="slide level2">
<h2>Neural nets in JAX (Flax)</h2>
<p><br></p>
<h3 id="defining-a-cnn-model-in-pytorch">Defining a CNN model in PyTorch</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb12-2"><a></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb12-3"><a></a></span>
<span id="cb12-4"><a></a><span class="kw">class</span> CNN(nn.Module):</span>
<span id="cb12-5"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb12-6"><a></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb12-7"><a></a>        <span class="va">self</span>.c1 <span class="op">=</span> nn.Conv2d(<span class="dv">3</span>, <span class="dv">32</span>, <span class="dv">3</span>)<span class="op">;</span> <span class="va">self</span>.c2 <span class="op">=</span> nn.Conv2d(<span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">3</span>)</span>
<span id="cb12-8"><a></a>        <span class="va">self</span>.fc <span class="op">=</span> nn.Linear(<span class="dv">64</span><span class="op">*</span><span class="dv">6</span><span class="op">*</span><span class="dv">6</span>, <span class="dv">10</span>)</span>
<span id="cb12-9"><a></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb12-10"><a></a>        x <span class="op">=</span> F.relu(<span class="va">self</span>.c1(x))<span class="op">;</span> x <span class="op">=</span> F.relu(<span class="va">self</span>.c2(x))</span>
<span id="cb12-11"><a></a>        x <span class="op">=</span> x.view(x.size(<span class="dv">0</span>), <span class="op">-</span><span class="dv">1</span>)<span class="op">;</span> <span class="cf">return</span> <span class="va">self</span>.fc(x)</span>
<span id="cb12-12"><a></a></span>
<span id="cb12-13"><a></a>model <span class="op">=</span> CNN()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><br></p>
<h3 id="defining-a-cnn-model-in-flax">Defining a CNN model in Flax</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a><span class="im">import</span> jax, jax.numpy <span class="im">as</span> jnp</span>
<span id="cb13-2"><a></a><span class="im">import</span> flax.linen <span class="im">as</span> nn</span>
<span id="cb13-3"><a></a></span>
<span id="cb13-4"><a></a><span class="kw">class</span> CNN(nn.Module):</span>
<span id="cb13-5"><a></a>    <span class="at">@nn.compact</span></span>
<span id="cb13-6"><a></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, x):</span>
<span id="cb13-7"><a></a>        x <span class="op">=</span> nn.relu(nn.Conv(<span class="dv">32</span>, (<span class="dv">3</span>,<span class="dv">3</span>))(x))</span>
<span id="cb13-8"><a></a>        x <span class="op">=</span> nn.relu(nn.Conv(<span class="dv">64</span>, (<span class="dv">3</span>,<span class="dv">3</span>))(x))</span>
<span id="cb13-9"><a></a>        x <span class="op">=</span> x.reshape((x.shape[<span class="dv">0</span>], <span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb13-10"><a></a>        <span class="cf">return</span> nn.Dense(<span class="dv">10</span>)(x)</span>
<span id="cb13-11"><a></a></span>
<span id="cb13-12"><a></a>model <span class="op">=</span> CNN()</span>
<span id="cb13-13"><a></a>params <span class="op">=</span> model.init(jax.random.PRNGKey(<span class="dv">0</span>), jnp.ones((<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">8</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="training-step-example" class="slide level2">
<h2>Training step example</h2>
<h3 id="one-training-step-in-pytorch">One training step in PyTorch</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a><span class="im">import</span> torch</span>
<span id="cb14-2"><a></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb14-3"><a></a></span>
<span id="cb14-4"><a></a>opt <span class="op">=</span> torch.optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">1e-3</span>)</span>
<span id="cb14-5"><a></a></span>
<span id="cb14-6"><a></a><span class="kw">def</span> train_step(x, y):</span>
<span id="cb14-7"><a></a>    opt.zero_grad()</span>
<span id="cb14-8"><a></a>    logits <span class="op">=</span> model(x)</span>
<span id="cb14-9"><a></a>    loss <span class="op">=</span> F.cross_entropy(logits, y)</span>
<span id="cb14-10"><a></a>    loss.backward()</span>
<span id="cb14-11"><a></a>    opt.step()</span>
<span id="cb14-12"><a></a>    <span class="cf">return</span> loss.item()</span>
<span id="cb14-13"><a></a></span>
<span id="cb14-14"><a></a>loss <span class="op">=</span> train_step(x_batch, y_batch)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<h3 id="one-training-step-in-jax-flax-optax">One training step in JAX + Flax + Optax</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a><span class="im">import</span> jax, jax.numpy <span class="im">as</span> jnp</span>
<span id="cb15-2"><a></a><span class="im">import</span> optax</span>
<span id="cb15-3"><a></a><span class="im">from</span> flax.training <span class="im">import</span> train_state</span>
<span id="cb15-4"><a></a></span>
<span id="cb15-5"><a></a><span class="kw">def</span> loss_fn(params, batch):</span>
<span id="cb15-6"><a></a>    logits <span class="op">=</span> model.<span class="bu">apply</span>(params, batch[<span class="st">"x"</span>])   <span class="co"># forward</span></span>
<span id="cb15-7"><a></a>    <span class="cf">return</span> optax.softmax_cross_entropy_with_integer_labels(</span>
<span id="cb15-8"><a></a>        logits, batch[<span class="st">"y"</span>]</span>
<span id="cb15-9"><a></a>    ).mean()</span>
<span id="cb15-10"><a></a></span>
<span id="cb15-11"><a></a><span class="at">@jax.jit</span></span>
<span id="cb15-12"><a></a><span class="kw">def</span> train_step(state, batch):</span>
<span id="cb15-13"><a></a>    grads <span class="op">=</span> jax.grad(loss_fn)(state.params, batch)</span>
<span id="cb15-14"><a></a>    <span class="cf">return</span> state.apply_gradients(grads<span class="op">=</span>grads)</span>
<span id="cb15-15"><a></a></span>
<span id="cb15-16"><a></a>state <span class="op">=</span> train_state.TrainState.create(</span>
<span id="cb15-17"><a></a>    apply_fn<span class="op">=</span>model.<span class="bu">apply</span>,</span>
<span id="cb15-18"><a></a>    params<span class="op">=</span>params,</span>
<span id="cb15-19"><a></a>    tx<span class="op">=</span>optax.adam(<span class="fl">1e-3</span>),</span>
<span id="cb15-20"><a></a>)</span>
<span id="cb15-21"><a></a>state <span class="op">=</span> train_step(state, batch)  <span class="co"># one update step</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="jax-ecosystem-an-overview" class="slide level2">
<h2>JAX Ecosystem: an overview</h2>
<h3 id="flax-flax">FLAX <img data-src="assets/flax.webp" style="vertical-align:middle; margin-right: 8px;" width="55" alt="Flax"></h3>
<p>Neural network library for JAX with modules, layers, optimizers, training loops.</p>
<h3 id="optax-optax">Optax <img data-src="assets/optax_logo.svg" style="vertical-align:middle; margin-right: 8px;" width="55" alt="Optax"></h3>
<p>Gradient processing and optimization library for JAX.</p>
<h3 id="blackjax-blackjax">BlackJAX <img data-src="assets/blackjax.png" style="vertical-align:middle; margin-right: 8px;" width="55" alt="BlackJAX"></h3>
<p>MCMC sampling library for JAX with HMC, NUTS, SGLD algorithms.</p>
<h3 id="numpyro-numpyro">NumPyro <img data-src="assets/numpyro.png" style="vertical-align:middle; margin-right: 8px;" width="55" alt="NumPyro"></h3>
<p>Probabilistic programming library for JAX with Bayesian modeling and inference.</p>
<h3 id="diffrax">Diffrax</h3>
<p>Differential equation solver library for JAX with ODE, SDE, DDE solvers.</p>
</section>
<section id="composability-trade-offs" class="slide level2">
<h2>Composability + Trade-offs</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><strong>Strengths</strong></p>
<ul>
<li><strong>NumPy-like</strong> API; clean function transforms</li>
<li><strong>Fast &amp; differentiable</strong> via XLA + <code>jit</code></li>
<li>Powerful <strong>composition</strong>: <code>jit(vmap(grad(...)))</code>, <code>shard_map</code> for multi-device</li>
<li>Ecosystem: <strong>Flax, Optax, BlackJAX, Distrax, Diffrax</strong></li>
</ul>
<p><strong>Weaknesses</strong></p>
<ul>
<li><strong>Steep learning curve</strong> (purity, PRNG keys, transformations)</li>
<li>Fewer <strong>off-the-shelf models</strong> vs PyTorch</li>
<li>Some APIs evolving (e.g., sharding tools) → more boilerplate at first</li>
</ul>
</div><div class="column" style="width:40%;">
<p><img data-src="assets/Logos/JaxLogo.png" style="width:55.0%"></p>
</div></div>
</section></section>
<section>
<section id="hands-on-cosmology-applications" class="title-slide slide level1 center">
<h1>Hands-On: Cosmology Applications</h1>

</section>
<section id="gz10-dataset" class="slide level2">
<h2>GZ10 Dataset</h2>
<p><br> <br></p>
<p><strong>Galaxy Zoo 10</strong> from MultimodalUniverse:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a><span class="im">from</span> datasets <span class="im">import</span> load_dataset</span>
<span id="cb16-2"><a></a>ds <span class="op">=</span> load_dataset(<span class="st">"MultimodalUniverse/gz10"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><br> <br></p>
<p><strong>Dataset statistics</strong>:</p>
<ul>
<li>~17,700 galaxy images</li>
<li>RGB images (256×256 pixels)</li>
<li>Fields: <code>gz10_label</code>, <code>redshift</code>, <code>object_id</code></li>
</ul>
<p><strong>For this workshop</strong>: Downsize to 32×32 or 64×64 for</p>
<div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>Explore the dataset</p>
</div>
<div class="solutionbox-body" style="font-size: 16px;">
<p>Notebook link : <code>Generative_AI_JAX_GZ10_VAE.ipynb</code></p>
</div>
</div>
</section>
<section id="example-a-variational-autoencoder-for-galaxies" class="slide level2">
<h2>Example A: Variational Autoencoder for galaxies</h2>

<img data-src="assets/ai/autoencoder-architecture.png" class="img-border-2 r-stretch quarto-figure-center" style="width:70.0%"><p class="caption">Variational Autoencoder</p><div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>Train a VAE on GZ10 galaxies and analyze latent space</p>
</div>
<div class="solutionbox-body" style="font-size: 16px;">
<p>Notebook link : <code>Generative_AI_JAX_GZ10_VAE.ipynb</code></p>
</div>
</div>
</section>
<section class="slide level2">

<h3 id="example-b-using-a-classifier-from-the-latent-space">Example B : Using a classifier from the latent space</h3>

<img data-src="assets/ai/deblender_diagram.png" class="img-border-2 r-stretch quarto-figure-center" style="width:70.0%"><p class="caption">VAE latent space to redshift</p><div class="solutionbox">
<div class="solutionbox-header" style="font-size: 20px;">
<p>Classify galaxy morphology from VAE latent space</p>
</div>
<div class="solutionbox-body" style="font-size: 16px;">
<p>Notebook link : <code>Generative_AI_JAX_GZ10_VAE_Classifier.ipynb</code></p>
</div>
</div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>AISSAI School 2025</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': true,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'slide',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/ASKabalan\.github\.io\/slides\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>